#!/bin/sh
#
# Builds the junixsocket website.
# 
# Copyright 2023 by Christian Kohlsch√ºtter
# SPDX-License-Identifier: Apache-2.0
#
cd "$(dirname $0)"/..
junixsocketDir=$(pwd)

(
set -x
mvn clean && \
cp junixsocket-codecoverage/jacoco-extra/*.exec junixsocket-codecoverage/target/ && \
mvn install site -D strict -Drelease -pl '!junixsocket-native,!junixsocket-native-common,!junixsocket-native-cross' && \
mvn install site -pl junixsocket-jetty,junixsocket-selftest-native-image && \
mvn javadoc:aggregate -P '!with-non-modularized' -Dstrict -pl '!junixsocket-native' && \
mvn jxr:aggregate jxr:test-aggregate -Dstrict -Drelease && \
mvn site:stage -Dstrict -Drelease -pl '!junixsocket-native,!junixsocket-native-common,!junixsocket-native-cross'
) || exit $?

echo "The website should now be inspected at ${junixsocketDir}/target/staging/index.html"
if [[ $(uname) == "Darwin" ]]; then
  open "${junixsocketDir}/target/staging/index.html"
fi
